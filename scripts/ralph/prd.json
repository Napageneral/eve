{
  "project": "eve",
  "branchName": "ralph/go-etl-complete",
  "phase": "go-etl-complete",
  "description": "Complete the ETL: copy all data from chat.db into eve.db so the Go binary is fully self-sufficient with no Python dependency.",
  "documentation": {
    "docs/ralph/GO_SINGLE_BINARY_PLAN.md": "Full design + rationale"
  },
  "verification": {
    "command": "./scripts/ralph/verify.sh",
    "notes": "Must stay fast and deterministic. Tests should use synthetic chat.db fixtures, not real user data."
  },
  "userStories": [
    {
      "id": "EVGO-011",
      "title": "ETL: Copy handles from chat.db to contacts + contact_identifiers",
      "description": "Read handles from chat.db and insert into contacts and contact_identifiers tables in eve.db. Handle is a phone/email identifier.",
      "acceptanceCriteria": [
        "Reads all handles from chat.db",
        "Inserts into contacts table (one per unique handle)",
        "Inserts into contact_identifiers with identifier and type (phone/email)",
        "Idempotent: running twice does not create duplicates",
        "Unit tests with synthetic chat.db fixture"
      ],
      "priority": 1,
      "passes": true,
      "files": ["internal/etl/handles.go", "internal/etl/handles_test.go"],
      "notes": "Handle ROWID becomes contact_id for foreign key references."
    },
    {
      "id": "EVGO-012",
      "title": "ETL: Copy chats from chat.db to chats table",
      "description": "Read chats from chat.db and insert into chats table in eve.db. Include chat_identifier, display_name, service_name, group status.",
      "acceptanceCriteria": [
        "Reads all chats from chat.db",
        "Inserts into chats table with proper fields",
        "Handles group vs 1:1 chats",
        "Idempotent via chat_identifier unique constraint",
        "Unit tests with synthetic chat.db fixture"
      ],
      "priority": 2,
      "passes": true,
      "files": ["internal/etl/chats.go", "internal/etl/chats_test.go"],
      "notes": "Chat ROWID from chat.db maps to chats.id in eve.db."
    },
    {
      "id": "EVGO-013",
      "title": "ETL: Copy messages from chat.db to messages table",
      "description": "Read messages from chat.db and insert into messages table. Must handle Apple timestamp conversion and foreign key references to chats/contacts.",
      "acceptanceCriteria": [
        "Reads messages with proper timestamp conversion (Apple epoch)",
        "Maps handle_id to sender_id (contact)",
        "Maps chat_id properly",
        "Idempotent via guid unique constraint",
        "Supports incremental sync (since_rowid watermark)",
        "Unit tests with synthetic data"
      ],
      "priority": 3,
      "passes": true,
      "files": ["internal/etl/messages.go", "internal/etl/messages_test.go"],
      "notes": "This is the main data volume. Must be efficient for 300k+ messages."
    },
    {
      "id": "EVGO-014",
      "title": "ETL: Copy attachments from chat.db to attachments table",
      "description": "Read attachments joined with message_attachment_join and insert into attachments table.",
      "acceptanceCriteria": [
        "Reads attachments via message_attachment_join",
        "Maps message_id properly",
        "Stores filename, mime_type, size",
        "Idempotent via guid",
        "Unit tests"
      ],
      "priority": 4,
      "passes": true,
      "files": ["internal/etl/attachments.go", "internal/etl/attachments_test.go"],
      "notes": "Attachment file paths are NOT copied, only metadata."
    },
    {
      "id": "EVGO-015",
      "title": "ETL: Build conversations from messages using gap threshold",
      "description": "Group messages into conversations based on time gaps. A new conversation starts when gap > 3 hours.",
      "acceptanceCriteria": [
        "Groups messages by chat_id",
        "Splits into conversations when time gap > 3 hours",
        "Creates conversation records with start_time, end_time, message_count",
        "Updates messages.conversation_id",
        "Idempotent",
        "Unit tests"
      ],
      "priority": 5,
      "passes": true,
      "files": ["internal/etl/conversations.go", "internal/etl/conversations_test.go"],
      "notes": "3-hour gap threshold matches the original ChatStats logic."
    },
    {
      "id": "EVGO-016",
      "title": "Wire full ETL in eve sync command",
      "description": "Update `eve sync` to run the complete ETL pipeline: handles → chats → messages → attachments → conversations.",
      "acceptanceCriteria": [
        "`eve sync` copies all data from chat.db to eve.db",
        "Outputs JSON with counts (no message text)",
        "Incremental sync works via watermark",
        "Full integration test with synthetic chat.db"
      ],
      "priority": 6,
      "passes": true,
      "files": ["cmd/eve/main.go", "internal/etl/sync.go"],
      "notes": "After this, Python ETL can be deleted."
    },
    {
      "id": "EVGO-017",
      "title": "Delete all Python code from eve repo",
      "description": "Remove the python/ directory and all Python-related files. Eve is now pure Go.",
      "acceptanceCriteria": [
        "python/ directory deleted",
        "No .py files remain",
        "Makefile updated to remove Python targets",
        "README updated",
        "All Go tests still pass"
      ],
      "priority": 7,
      "passes": false,
      "files": ["python/", "Makefile", "README.md"],
      "notes": "Final cleanup. Eve is now a single Go binary."
    }
  ]
}
