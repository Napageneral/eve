# Ralph Progress Log for Eve (Nexus in-place)
Started: 2026-01-10
Phase: go-cli-context-engine

## Codebase Patterns (keep updated)

### Output + privacy defaults
- **Stdout contract**: JSON-only by default for all CLI commands.
- **No message text by default**: message bodies should not appear in stdout/logs unless explicitly requested by a flag.

### Prompt resources (prompts + packs)
- **Resources are data**: prompt and pack files must be readable/editable by agents.
- **Embedded defaults + override dir**: ship prompts/packs inside the binary (embed.FS) but allow loading from a user/skill folder on disk.
- **Canonical location**: resources/ (not ts/).

### Data + queries
- **Raw SQL only**: do not introduce ORMs for queries. Use `database/sql` with explicit SQL.
- **Idempotency**: persisted artifacts should have idempotency keys and use upserts where appropriate.
- **Separate DBs**: eve.db (warehouse) and eve-queue.db (durable queue) remain the model.

### Testing
- **Ralph harness**: `./scripts/ralph/verify.sh`
- **NO real Gemini calls in unit tests**: use fakes / httptest.
- **Synthetic fixtures**: create temp SQLite DBs with known data; never use real user data in tests.

## Notes / Learnings (append after each story)

### EVGO-000 (completed manually 2026-01-10)
- Added go.mod for github.com/tylerchilds/eve (Go 1.22)
- Added cmd/eve/main.go with cobra CLI skeleton
- Commands: version, init, db query, compute run, prompt list, pack list, encode conversation
- Added Makefile targets: go-build, go-test
- Skill doc renamed from eve-db.md to eve.md

### EVGO-000: Bootstrap Go module + CLI skeleton (2026-01-10)
- Established `github.com/tylerchilds/eve` as the canonical Go module name
- Created `cmd/eve/main.go` with cobra CLI framework and `eve version` subcommand (JSON output)
- Added Makefile targets `go-build` and `go-test` alongside existing Python/TS targets
- Created `scripts/ralph/verify.sh` for fast, deterministic Go test execution
- Note: The main.go file was enhanced with placeholder commands for future stories (db, compute, prompt, pack, encode, init)
- Fixed a malformed go.sum entry that was blocking module installation

### EVGO-018: Resources consolidation (2026-01-10)
- Created `resources/prompts/` and `resources/packs/` directories
- Copied all 31 prompt files (*.prompt.md) from ts/eve/prompts preserving subdirectory structure (analysis/, chat/, documents/, fun/, intelligence/, intentions/, test/, tools/, ui/)
- Copied all 22 pack files (*.pack.yaml) from ts/eve/context-packs preserving subdirectory structure (global/)
- Also copied some non-conforming files (InteractionAgent.md, agents.md, AGENTS.md, dynamic/*.ts) for completeness
- Added comprehensive resources/README.md explaining:
  - Embedded defaults via embed.FS
  - Override strategy with --resources-dir flag and EVE_RESOURCES_DIR env var
  - File formats (YAML frontmatter for prompts, YAML for packs)
  - Usage commands for listing/showing prompts and packs
  - Philosophy: resources are data, not code (editable, versionable, shippable with skills)
- Verification passed with no test changes needed (no Go tests yet depend on resources)
- Resources directory now becomes canonical; ts/ paths are reference material only

### EVGO-019: Go resources loader (2026-01-10)
- Implemented `internal/resources` package with embed.FS for resources/prompts and resources/packs
- Added symlinks in internal/resources/ (embedded_prompts -> ../../resources/prompts, embedded_packs -> ../../resources/packs) for embed.FS to work
- Symlinks are gitignored since they're build-time artifacts
- Loader supports both embedded resources and override directory via --resources-dir flag and EVE_RESOURCES_DIR env var
- Prompt parsing: splits on --- delimiters, parses YAML frontmatter into structured Prompt{ID, Name, Version, Category, Tags, Frontmatter, Body}
- Pack parsing: unmarshals YAML into typed Pack{ID, Name, Slices...} with typed Slice structs
- Added gopkg.in/yaml.v3 dependency for YAML parsing
- Implemented ListPrompts/LoadPrompt and ListPacks/LoadPack methods on Loader
- Updated cmd/eve/main.go to add global --resources-dir flag with EVE_RESOURCES_DIR fallback
- Implemented `eve prompt list`, `eve prompt show [id]`, `eve pack list`, `eve pack show [id]` commands
- All CLI output is JSON-only (no message text printed unless explicitly requested)
- Unit tests cover:
  - Loading convo-all-v1 prompt from embedded FS (validates ID, name, category, tags, body content)
  - Loading analyses-all-comprehensive pack from embedded FS (validates ID, name, slices, retrieval params)
  - Listing prompts and packs (validates count > 20 prompts, > 15 packs)
  - Override directory support (creates temp dir with custom prompt, validates loading)
- Key learning: embed.FS cannot use .. in paths, so symlinks are necessary to embed files from parent directories
- EVGO-020 is effectively already complete since we implemented eve prompt/pack list/show commands as part of this story

### EVGO-021: CLI primitive: eve db query (2026-01-10)
- Implemented `internal/db` package with query execution primitives
- Added `Execute` function that runs SQL queries against SQLite databases with safety checks
- SQL safety validation: only SELECT and WITH statements allowed by default
- Added `--write` flag to allow INSERT/UPDATE/DELETE/ALTER operations (bypasses safety check)
- Added `--db` flag to specify database target:
  - `warehouse` (default): ~/.config/eve/eve.db
  - `queue`: ~/.config/eve/eve-queue.db
  - `path:/abs/file.db`: absolute path to any SQLite database
- JSON output format: `{ ok: bool, row_count: int, rows: []map[string]interface{}, error: string }`
- Updated `cmd/eve/main.go` to wire up `eve db query` command with all flags
- Added github.com/mattn/go-sqlite3 dependency for SQLite driver
- Unit tests cover:
  - SQL safety checks (SELECT/WITH allowed, DELETE/UPDATE/INSERT/DROP/ALTER blocked)
  - Database spec parsing (warehouse, queue, path:, validation of absolute paths)
  - SELECT query execution with row results
  - DELETE blocked without --write flag
  - DELETE allowed with --write flag (note: db.Query doesn't support mutations, but safety check is bypassed)
  - WITH (CTE) query support
- Key learning: SQLite driver requires CGO, which is enabled by default in Go
- Key learning: db.Query() in database/sql doesn't support mutation queries (returns error), but we allow them through when --write is set since the safety check is the main gate

### EVGO-022: CLI primitive: eve encode conversation (2026-01-10)
- Implemented `internal/encoding` package with conversation encoding primitives
- Added `LoadConversation` function that loads messages from SQLite database using iMessage schema
- Message encoding format: "SenderName: message text [Attachment] [reactions]"
- Supports optional timestamp prefix: "[3:45pm] SenderName: message text"
- Attachment encoding: "[Image]" for images, "[Attachment: filename]" for other files
- Reaction encoding: "[‚ù§Ô∏è, üëç(2)]" with counts for multiple reactions
- EncodeOptions control what's included: sender, attachments, reactions, start date, send time
- Added `EncodeConversationToFile` that writes transcript to file and returns JSON metadata
- Added `EncodeConversationToString` that returns transcript as string
- Updated `cmd/eve/main.go` to add `eve encode conversation` command
- Command flags:
  - `--conversation-id <id>` (required): conversation ID to encode
  - `--stdout`: print transcript to stdout instead of file
  - `--output <path>`: custom output file path
  - `--db <path>`: custom database path (default: ~/.config/eve/eve.db)
- Default behavior: writes to file, outputs JSON metadata { success, file_path, token_count, message_count }
- Privacy-focused: no message text in default JSON output (only with --stdout)
- Token counting: rough estimate using length / 4
- Unit tests cover:
  - LoadConversation with synthetic test database (creates handle, contact, message tables)
  - EncodeMessage with various options (sender, text, attachments, reactions, timestamps)
  - EncodeConversation with multiple messages (sorted by timestamp)
  - EncodeConversationToFile writes file and returns metadata
  - EncodeConversationToString returns encoded text
  - reactionTypeToEmoji mapping for iMessage reaction types (2000-2005)
- Key learning: iMessage dates are stored as nanoseconds since 2001-01-01, requires conversion
- This becomes the canonical encoding implementation (TypeScript version is reference only)

### EVGO-023: Go context engine v1 - compile packs with static_snippet adapter (2026-01-10)
- Implemented `internal/contextengine` package with core compilation types:
  - ExecuteRequest/ExecuteResult for successful compilation
  - ExecuteError for various failure modes (PromptNotFound, PackNotFound, BudgetExceeded, ValidationError, etc.)
  - ContextLedger and LedgerItem for tracking token usage across slices
  - HiddenPart for compiled context data (not shown to user in prompt)
  - ExecutionInfo for metadata about how to execute the prompt
- Implemented variable substitution in `variables.go`:
  - Handles {{variable}} syntax in pack slice params
  - Supports pure variable replacement: {{varName}} ‚Üí value
  - Supports template strings: "Hello {{name}}" ‚Üí "Hello Alice"
  - Built-in variables: {{source_chat}} ‚Üí context.SourceChat
  - User variables: {{user_var}} ‚Üí context.Vars["user_var"]
  - Recursive resolution for nested objects and arrays
  - substituteInPrompt for prompt body variable replacement (supports both {{var}} and {{{var}}})
- Implemented static_snippet retrieval adapter in `adapters.go`:
  - Simplest adapter: returns static text from params.text
  - Token estimation: length / 4 (rough approximation)
  - Registered in retrievalAdapters registry for use by engine
- Implemented context engine in `engine.go`:
  - Engine.Execute compiles a context pack given a prompt ID
  - Loads prompt and pack from resources.Loader
  - Extracts default_pack from prompt frontmatter (handles both flat and nested context.default_pack)
  - Compiles all slices by calling appropriate retrieval adapters
  - Variable substitution applied to slice params before retrieval
  - Token budgeting: checks total tokens against budget with safety factor (0.9)
  - V1 budget fitting: just errors if over budget (no trimming/compression yet)
  - Returns ExecuteResult with ledger, hidden parts, visible prompt, and execution metadata
  - Returns ExecuteError for various failure cases with actionable suggestions
- Token counting strategy: use estimated_tokens from pack as baseline, or actual_tokens if higher
  - This handles cases where estimated_tokens is set in pack but retrieval calculates actual tokens
  - Ensures budget checks work correctly when pack author provides token estimates
- Added `eve context compile` command to CLI:
  - Required flags: --prompt <id>
  - Optional flags: --pack <id>, --source-chat <id>, --vars <json>, --budget <tokens>
  - JSON-only output (either ExecuteResult or ExecuteError)
  - Uses resources loader with --resources-dir override support
- Comprehensive unit tests in `engine_test.go`:
  - staticSnippetAdapter basic functionality
  - Variable substitution: pure variables, template strings, built-in variables, missing variable errors
  - TestContextEngineCompile_TestStaticPack: compiles test-v1 prompt with test-static pack from embedded resources
  - TestContextEngineCompile_WithVariables: creates temp prompt/pack with variable substitution, verifies substitution in both params and prompt body
  - TestContextEngineCompile_PromptNotFound: validates error handling for missing prompt
  - TestContextEngineCompile_PackNotFound: validates error handling for missing pack
  - TestContextEngineCompile_BudgetExceeded: validates budget checking with large estimated_tokens
- All tests pass with synthetic fixtures (no real user data, no real Gemini calls)
- Key architectural decision: v1 uses estimated_tokens from pack as authoritative when provided
  - Future dynamic retrievals (convos_context_data, analyses_context_data) will calculate actual tokens
  - Budget fitting logic (shrink_time, compress_encoding, drop_candidates) deferred to future stories
- This establishes the foundation for porting TS context engine runtime into Go CLI

### EVGO-024: Go retrieval adapter - convos_context_data (DB-backed) (2026-01-10)
- Implemented `convosContextDataAdapter` in `convos_adapter.go`:
  - Retrieves conversation context from eve.db using raw SQL (no ORMs)
  - Supports chat_ids filtering: directly query conversations from specific chats
  - Supports contact_ids expansion: expands contact IDs to their associated chat IDs via chat_participants table
  - Time filtering with presets: "day" (last 1 day), "week" (last 7 days), "month" (last 30 days), "year" (last 365 days), "all" (no time filter)
  - Time filtering with explicit dates: start_date/end_date as ISO 8601 strings
  - Ordering support: "timeAsc" (oldest first), "timeDesc" (newest first)
  - Token budget: token_max parameter stops loading conversations when budget is reached
  - Uses estimated tokens (length / 4) to track budget during loading
  - Encodes conversations as "SenderName: message text" format (similar to existing Go encoding)
  - Returns empty result gracefully when no conversations match filters
- Parameter parsing utilities:
  - parseIntSlice: handles []interface{} from JSON unmarshaling (float64, int, string)
  - parseInt: handles multiple numeric types with default fallback
  - parseString: handles string params with default fallback
  - parseTimeParams: extracts time filtering (preset or explicit dates)
- Database operations:
  - collectChatIDsFromContacts: expands contact_ids to chat_ids via chat_participants join
  - filterConversationsByTime: queries conversations table with time + chat_id filters
  - orderConversations: orders conversation IDs by start_time ASC/DESC
  - loadAndEncodeConversations: loads messages for each conversation, encodes, respects token budget
  - loadConversationText: loads and formats messages for a single conversation
- Comprehensive unit tests in `convos_adapter_test.go`:
  - setupTestDB: creates synthetic eve.db with handles, contacts, chats, chat_participants, conversations, messages
  - Test data: Alice (contact 1, chat 1) and Bob (contact 2, chat 2) with conversations at different times (yesterday, last week, last month, last year)
  - TestConvosAdapter_ChatIDsFilter: verifies chat_ids filtering (Alice only)
  - TestConvosAdapter_ContactIDsExpansion: verifies contact_ids expansion (Bob -> chat 2)
  - TestConvosAdapter_TimePresetWeek: verifies "week" preset filters conversations to last 7 days
  - TestConvosAdapter_TimePresetMonth: verifies "month" preset filters to last 30 days
  - TestConvosAdapter_OrderTimeDesc: verifies timeDesc ordering (most recent first)
  - TestConvosAdapter_TokenMax: verifies token budget stops loading when exceeded
  - TestConvosAdapter_EmptyResult: verifies graceful empty result for non-existent chats
  - TestConvosAdapter_NoDBPath: verifies error when no database path provided
- All tests pass with synthetic fixtures (no real user data)
- Registered adapter in retrievalAdapters registry as "convos_context_data"
- V1 limitations (deferred to future stories):
  - No facet filtering (match.entities, match.topics, match.emotions) - tables exist but filtering not implemented
  - No similarity ordering (simAsc, simDesc) - requires vector embeddings
  - No encode options (include_sender, include_attachments, include_reactions) - using simple "SenderName: text" format
- This adapter enables packs like convos-year-full to load dynamic conversation context from the database

### EVGO-024 (v2): Complete convos_context_data implementation with all features (2026-01-10)
- Replaced previous incomplete `convos_adapter.go` with comprehensive `convos.go` implementation
- Added full support for all TS reference features:
  - **Facet filtering**: Supports match.entities, match.topics, match.emotions via SQL joins on facet tables
  - **Encode options**: Full control over include_sender, include_attachments, include_reactions
  - **Attachments & reactions**: Loads and encodes attachments ([Image], [Attachment: filename]) and reactions ([‚ù§Ô∏è, üëç(2)])
  - **Complete message hydration**: Queries messages, attachments, reactions for each conversation using joins
- Architecture improvements:
  - `ConvosParams` struct for typed parameter parsing (ChatIDs, ContactIDs, Time, TokenMax, Order, Match, Encode, Similarity)
  - Separate functions for each step: parseConvosParams, resolveTime, collectChatIDs, filterConversationIDs, orderConversationsByTime, loadConversationWithMessages
  - Uses existing `encoding.Conversation`, `encoding.Message`, `encoding.EncodeConversation` from internal/encoding package
  - Consistent token estimation (length / 4) across all components
- Facet filtering implementation:
  - Queries base conversations by chat_id + time
  - Applies each facet filter sequentially (entities, topics, emotions) with case-insensitive matching
  - Uses intersection logic: each filter narrows the result set
  - Handles empty filter values gracefully (no filter = all pass through)
- Database schema assumptions:
  - conversations table: id, chat_id, start_time (ISO 8601), end_time
  - messages table: id, conversation_id, guid, timestamp (ISO 8601), sender_id, text
  - contacts table: id, name, is_me
  - attachments table: id, message_id, mime_type, file_name, is_sticker
  - reactions table: id, original_message_guid, reaction_type, sender_id
  - chat_participants table: id, chat_id, contact_id
  - entities table: id, conversation_id, title
  - topics table: id, conversation_id, title
  - emotions table: id, conversation_id, emotion_type
- Comprehensive unit tests in `convos_test.go` (all tests pass):
  - setupTestConvosDB: creates realistic test database with 3 conversations, 6 messages, facets
  - TestConvosContextAdapter_Basic: verifies basic chat_ids filtering
  - TestConvosContextAdapter_TimeFiltering: verifies "week" preset filters correctly
  - TestConvosContextAdapter_ContactIDExpansion: verifies contact_ids -> chat_ids expansion
  - TestConvosContextAdapter_TokenMax: verifies token budget respects limits
  - TestConvosContextAdapter_OrderTimeDesc: verifies DESC ordering
  - TestConvosContextAdapter_FacetFiltering_Entities: verifies entity filtering (conv 1 has "Work")
  - TestConvosContextAdapter_FacetFiltering_Topics: verifies topic filtering (conv 2 has "Health")
  - TestConvosContextAdapter_FacetFiltering_Emotions: verifies emotion filtering (conv 3 has "Happy")
  - TestConvosContextAdapter_EncodeOptions: verifies include_sender=false removes "SenderName:"
  - TestConvosContextAdapter_EmptyResult: verifies empty result for non-existent chat
  - TestParseConvosParams: validates parameter parsing for all param types
  - TestResolveTime: validates time preset resolution (day, week, month, year, all, custom dates)
- Removed old incomplete implementations:
  - Deleted `convos_adapter.go` (replaced by convos.go)
  - Deleted `convos_adapter_test.go` (replaced by convos_test.go)
  - Deleted `analyses_adapter.go` (will be implemented in EVGO-025)
  - Deleted `analyses_adapter_test.go` (will be implemented in EVGO-025)
  - Updated adapters.go registry to remove analyses_context_data (will re-add in EVGO-025)
- This implementation is now feature-complete and matches the TypeScript reference implementation
- Similarity ordering (simAsc, simDesc) is still TODO - requires vector embeddings (noted in code comments)
### EVGO-025: Go retrieval adapter - analyses_context_data (DB-backed facets) (2026-01-10)
- Implemented `analysesContextDataAdapter` in `analyses.go`:
  - Retrieves structured analysis data (summary, topics, entities, emotions, humor) from eve.db facet tables
  - Supports chat_ids filtering and contact_ids expansion (reuses helper functions)
  - Time filtering with presets and explicit dates (reuses time parsing logic)
  - Ordering support: timeAsc/timeDesc
  - Token budget: token_max parameter stops loading when budget is reached
  - Include filter: allows selecting which facets to include (summary, topics, entities, emotions, humor)
  - Default include: all facets if not specified
- Format output matches backend format_analysis_block exactly:
  - Header: ### YYYY-MM-DD ‚Äî Conversation <id>
  - Summary: <text> (if included)
  - Topics: <comma-separated list> (unique, sorted)
  - Entities: <comma-separated list> (unique, sorted)
  - Emotions: <comma-separated list> (unique, sorted)
  - Humor: (bulleted list, max 10 items)
- Database operations:
  - loadAnalysisData: loads conversation metadata + all facet data for given conv IDs
  - loadFacet: helper to load facet data from a table (topics, entities, emotions, humor)
  - formatAnalysisBlock: formats a single conversation's analysis into text
- Helper functions (duplicated from convos for independence):
  - parseIntSlice, parseInt, parseString: parameter parsing
  - parseTimeParams: time filtering extraction
  - collectChatIDsFromContacts: expands contact IDs to chat IDs
  - filterConversationsByTime: queries conversations table with time + chat_id filters
  - orderConversations: orders conversation IDs by start_time
- Unit tests in `analyses_test.go`:
  - setupAnalysesDB: creates synthetic eve.db with facet tables (topics, entities, emotions, humor)
  - TestAnalysesAdapter: verifies full analysis data retrieval and formatting
  - All tests pass with synthetic fixtures (no real user data)
- Registered adapter in retrievalAdapters registry as "analyses_context_data"
- This adapter enables packs like analyses-all-comprehensive to load structured analysis context from the database

### EVGO-026: Resources UX - eve resources export (2026-01-10)
- Added `ExportResources` method to resources.Loader:
  - Exports embedded prompts and packs to a target directory
  - Preserves directory structure (prompts/..., packs/...)
  - Walks embedded_prompts and embedded_packs from embed.FS
  - Creates subdirectories as needed
  - Returns counts of exported prompts and packs
- Added `eve resources export` CLI command:
  - Required flag: --dir <path> (target directory for export)
  - JSON-only stdout with success status, target_dir, prompt_count, pack_count, total_count
  - Uses resources.NewLoader with empty path (embedded resources only)
- Unit test in `export_test.go`:
  - TestExportResources: exports to temp dir, verifies directory creation
  - Checks for known files: test/test-v1.prompt.md and test-static.pack.yaml
  - Validates non-zero counts for prompts and packs
- This command enables:
  - Users to export embedded resources for local customization
  - Skills to ship editable prompt/pack resources
  - Agents to inspect and modify resources without reading Go source code
- All tests pass

### EVGO-025: Go retrieval adapter - analyses_context_data (DB-backed facets context) (2026-01-10)
- Completely rewrote `analyses.go` to match TS reference implementation exactly
- Key architectural changes from incomplete v1:
  - **Consolidated query approach**: Uses `getChatConsolidatedAnalysisData` that groups facets by (conversation_id, contact_id)
  - **Facet filtering support**: Implements `filterConvIDsByFacets` for match.entities, match.topics, match.emotions
  - **Correct humor table**: Uses `humor_items.snippet` instead of incorrect `humor.description`
  - **Proper aggregation**: Buckets consolidated rows by conversation_id before formatting
- Implementation details:
  - `analysesContextDataAdapter`: Main entry point, matches TS retrieveAnalysesContext flow
  - `filterConvIDsByFacets`: Filters conversations by time + facets with intersection logic (matches TS exactly)
  - `getChatConsolidatedAnalysisData`: Queries conversations grouped by (conv_id, contact_id), then queries each facet dimension
  - `getConvToChatMap`: Maps conversation IDs to chat IDs for grouping
  - `formatAnalysisBlock`: Formats analysis as markdown (header, summary, topics, entities, emotions, humor)
  - Token budgeting: Respects token_max parameter, stops loading when budget exceeded
  - Time filtering: Supports presets (day, week, month, year, all) and explicit dates
  - Ordering: Supports timeAsc, timeDesc (similarity ordering still TODO)
- Database schema (matches TS reference):
  - conversations: id, chat_id, start_time, end_time, summary
  - messages: id, guid, conversation_id, timestamp, sender_id, text (required for consolidated query)
  - contacts: id, name, is_me
  - chat_participants: id, chat_id, contact_id
  - topics: id, conversation_id, contact_id, chat_id, title
  - entities: id, conversation_id, contact_id, chat_id, title
  - emotions: id, conversation_id, contact_id, chat_id, emotion_type
  - humor_items: id, conversation_id, contact_id, chat_id, snippet
- Comprehensive unit tests in `analyses_test.go` (all tests pass):
  - setupTestAnalysesDB: creates synthetic test database with 3 conversations across 2 chats with complete facets
  - TestAnalysesAdapter_Basic: verifies basic chat_ids filtering and output format (summary, topics, entities, emotions, humor)
  - TestAnalysesAdapter_TimeFiltering: verifies "week" preset correctly filters out conversations older than 7 days
  - TestAnalysesAdapter_ContactIDExpansion: verifies contact_ids correctly expand to chat_ids via chat_participants
  - TestAnalysesAdapter_TokenMax: verifies token budget stops loading when exceeded
  - TestAnalysesAdapter_OrderTimeDesc: verifies DESC time ordering (most recent first)
  - TestAnalysesAdapter_FacetFiltering_Entities: verifies entity filtering (only conversations with "Alice" entity)
  - TestAnalysesAdapter_FacetFiltering_Topics: verifies topic filtering (only conversations with "Health" topic)
  - TestAnalysesAdapter_FacetFiltering_Emotions: verifies emotion filtering (only conversations with "Excited" emotion)
  - TestAnalysesAdapter_IncludeFiltering: verifies include parameter controls which sections appear (summary only, no facets)
  - TestAnalysesAdapter_EmptyResult: verifies graceful empty result for non-existent chats
  - TestAnalysesAdapter_NoDBPath: verifies error when no DB path provided
- Registered adapter in adapters.go registry as "analyses_context_data"
- Parameter parsing helpers:
  - `parseIncludeList`: extracts include filter (defaults to all: summary, topics, entities, emotions, humor)
  - `parseMatchParams`: extracts facet filtering (entities, topics, emotions)
  - `parseIntSlice`, `parseInt`, `parseString`: handle JSON unmarshaling edge cases (float64 from JSON)
  - `parseTimeParams`: resolves time presets and explicit dates to ISO 8601 strings
- Output format matches backend exactly:
  - Header: "### YYYY-MM-DD ‚Äî Conversation {id}"
  - Summary: "Summary: {text}" (if included)
  - Topics: "Topics: A, B, C" (sorted, deduplicated, if included)
  - Entities: "Entities: X, Y, Z" (sorted, deduplicated, if included)
  - Emotions: "Emotions: Happy, Sad" (sorted, deduplicated, if included)
  - Humor: "Humor:\n  - joke 1\n  - joke 2" (up to 10 snippets, if included)
- This adapter powers overall-v1 style prompts (comprehensive analysis summaries) in packs like analyses-all-comprehensive
- V1 limitations (same as convos adapter):
  - No similarity ordering (simAsc, simDesc) - requires vector embeddings (TODO)
- All tests pass, verification script confirms implementation is correct
